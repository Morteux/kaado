var dictionary = {
    "hiragana": [
        { "latin": "a", "japanese": "あ" },
        { "latin": "i", "japanese": "い" },
        { "latin": "u", "japanese": "う" },
        { "latin": "e", "japanese": "え" },
        { "latin": "o", "japanese": "お" },

        { "latin": "ka", "japanese": "か" },
        { "latin": "ki", "japanese": "き" },
        { "latin": "ku", "japanese": "く" },
        { "latin": "ke", "japanese": "け" },
        { "latin": "ko", "japanese": "こ" },

        { "latin": "sa", "japanese": "さ" },
        { "latin": "shi", "japanese": "し" },
        { "latin": "su", "japanese": "す" },
        { "latin": "se", "japanese": "せ" },
        { "latin": "so", "japanese": "そ" },

        { "latin": "ta", "japanese": "た" },
        { "latin": "chi", "japanese": "ち" },
        { "latin": "tsu", "japanese": "つ" },
        { "latin": "te", "japanese": "て" },
        { "latin": "to", "japanese": "と" },

        { "latin": "na", "japanese": "な" },
        { "latin": "ni", "japanese": "に" },
        { "latin": "nu", "japanese": "ぬ" },
        { "latin": "ne", "japanese": "ね" },
        { "latin": "no", "japanese": "の" },

        { "latin": "ha", "japanese": "は" },
        { "latin": "hi", "japanese": "ひ" },
        { "latin": "fu", "japanese": "ふ" },
        { "latin": "he", "japanese": "へ" },
        { "latin": "ho", "japanese": "ほ" },

        { "latin": "ma", "japanese": "ま" },
        { "latin": "mi", "japanese": "み" },
        { "latin": "mu", "japanese": "む" },
        { "latin": "me", "japanese": "め" },
        { "latin": "mo", "japanese": "も" },

        { "latin": "ya", "japanese": "や" },
        { "latin": "yu", "japanese": "ゆ" },
        { "latin": "yo", "japanese": "よ" },

        { "latin": "ra", "japanese": "ら" },
        { "latin": "ri", "japanese": "り" },
        { "latin": "ru", "japanese": "る" },
        { "latin": "re", "japanese": "れ" },
        { "latin": "ro", "japanese": "ろ" },

        { "latin": "wa", "japanese": "わ" },
        { "latin": "o", "japanese": "を" },
        { "latin": "n", "japanese": "ん" }
    ],
    "hiragana_tenten": [
        { "latin": "ga", "japanese": "が" },
        { "latin": "gi", "japanese": "ぎ" },
        { "latin": "gu", "japanese": "ぐ" },
        { "latin": "ge", "japanese": "げ" },
        { "latin": "go", "japanese": "ご" },

        { "latin": "za", "japanese": "ざ" },
        { "latin": "ji", "japanese": "じ" },
        { "latin": "zu", "japanese": "ず" },
        { "latin": "ze", "japanese": "ぜ" },
        { "latin": "zo", "japanese": "ぞ" },

        { "latin": "da", "japanese": "だ" },
        { "latin": "ji", "japanese": "ぢ" },
        { "latin": "zu", "japanese": "づ" },
        { "latin": "de", "japanese": "で" },
        { "latin": "do", "japanese": "ど" },

        { "latin": "ba", "japanese": "ば" },
        { "latin": "bi", "japanese": "び" },
        { "latin": "bu", "japanese": "ぶ" },
        { "latin": "be", "japanese": "べ" },
        { "latin": "bo", "japanese": "ぼ" }
    ],
    "hiragana_maru": [
        { "latin": "pa", "japanese": "ぱ" },
        { "latin": "pi", "japanese": "ぴ" },
        { "latin": "pu", "japanese": "ぷ" },
        { "latin": "pe", "japanese": "ぺ" },
        { "latin": "po", "japanese": "ぽ" }
    ],
    "hiragana_diptongo": [
        { "latin": "kya", "japanese": "きゃ" },
        { "latin": "kyu", "japanese": "きゅ" },
        { "latin": "kyo", "japanese": "きょ" },
        
        { "latin": "sha", "japanese": "しゃ" },
        { "latin": "shu", "japanese": "しゅ" },
        { "latin": "sho", "japanese": "しょ" },
        
        { "latin": "cha", "japanese": "ちゃ" },
        { "latin": "chu", "japanese": "ちゅ" },
        { "latin": "cho", "japanese": "ちょ" },
        
        { "latin": "nya", "japanese": "にゃ" },
        { "latin": "nyu", "japanese": "にゅ" },
        { "latin": "nyo", "japanese": "にょ" },

        { "latin": "hya", "japanese": "ひゃ" },
        { "latin": "hyu", "japanese": "ひゅ" },
        { "latin": "hyo", "japanese": "ひょ" },
        
        { "latin": "mya", "japanese": "みゃ" },
        { "latin": "myu", "japanese": "みゅ" },
        { "latin": "myo", "japanese": "みょ" },
        
        { "latin": "rya", "japanese": "りゃ" },
        { "latin": "ryu", "japanese": "りゅ" },
        { "latin": "ryo", "japanese": "りょ" }
    ],
    "hiragana_diptongo_tenten": [
        { "latin": "gya", "japanese": "ぎゃ" },
        { "latin": "gyu", "japanese": "ぎゅ" },
        { "latin": "gyo", "japanese": "ぎょ" },
        
        { "latin": "jya", "japanese": "じゃ" },
        { "latin": "jyu", "japanese": "じゅ" },
        { "latin": "jyo", "japanese": "じょ" },
        
        { "latin": "bya", "japanese": "びゃ" },
        { "latin": "byu", "japanese": "びゅ" },
        { "latin": "byo", "japanese": "びょ" }
    ],
    "hiragana_diptongo_maru": [
        { "latin": "pya", "japanese": "ぴゃ" },
        { "latin": "pyu", "japanese": "ぴゅ" },
        { "latin": "pyo", "japanese": "ぴょ" }
    ],
    "katakana": [
        { "latin": "a", "japanese": "ア" },
        { "latin": "i", "japanese": "イ" },
        { "latin": "u", "japanese": "ウ" },
        { "latin": "e", "japanese": "エ" },
        { "latin": "o", "japanese": "オ" },

        { "latin": "ka", "japanese": "カ" },
        { "latin": "ki", "japanese": "キ" },
        { "latin": "ku", "japanese": "ク" },
        { "latin": "ke", "japanese": "ケ" },
        { "latin": "ko", "japanese": "コ" },

        { "latin": "sa", "japanese": "サ" },
        { "latin": "shi", "japanese": "シ" },
        { "latin": "su", "japanese": "ス" },
        { "latin": "se", "japanese": "セ" },
        { "latin": "so", "japanese": "ソ" },

        { "latin": "ta", "japanese": "タ" },
        { "latin": "chi", "japanese": "チ" },
        { "latin": "tsu", "japanese": "ツ" },
        { "latin": "te", "japanese": "テ" },
        { "latin": "to", "japanese": "ト" },

        // { "latin": "na", "japanese": "ナ" },
        // { "latin": "ni", "japanese": "ニ" },
        // { "latin": "nu", "japanese": "ヌ" },
        // { "latin": "ne", "japanese": "ネ" },
        // { "latin": "no", "japanese": "ノ" },

        // { "latin": "ha", "japanese": "ハ" },
        // { "latin": "hi", "japanese": "ヒ" },
        // { "latin": "fu", "japanese": "フ" },
        // { "latin": "he", "japanese": "ヘ" },
        // { "latin": "ho", "japanese": "ホ" },

        // { "latin": "ma", "japanese": "マ" },
        // { "latin": "mi", "japanese": "ミ" },
        // { "latin": "mu", "japanese": "ム" },
        // { "latin": "me", "japanese": "メ" },
        // { "latin": "mo", "japanese": "モ" },

        // { "latin": "ya", "japanese": "ヤ" },
        // { "latin": "yu", "japanese": "ユ" },
        // { "latin": "yo", "japanese": "ヨ" },

        // { "latin": "ra", "japanese": "ラ" },
        // { "latin": "ri", "japanese": "リ" },
        // { "latin": "ru", "japanese": "ル" },
        // { "latin": "re", "japanese": "レ" },
        // { "latin": "ro", "japanese": "ロ" },

        // { "latin": "wa", "japanese": "ワ" },
        // { "latin": "o", "japanese": "オ" },
        // { "latin": "n", "japanese": "ン" }
    ],
    "kanji": [
    ]
};

var hiragana = true;
var hiragana_tenten = false;
var hiragana_maru = false;
var hiragana_diptongo = false;
var hiragana_diptongo_tenten = false;
var hiragana_diptongo_maru = false;
var katakana = false;

function changeHiragana() {
    hiragana = !hiragana;
}

function changeHiraganaTenten() {
    hiragana_tenten = !hiragana_tenten;
}

function changeHiraganaMaru() {
    hiragana_maru = !hiragana_maru;
}

function changeHiraganaDiptongo() {
    hiragana_diptongo = !hiragana_diptongo;
}

function changeHiraganaDiptongoTenten() {
    hiragana_diptongo_tenten = !hiragana_diptongo_tenten;
}

function changeHiraganaDiptongoMaru() {
    hiragana_diptongo_maru = !hiragana_diptongo_maru;
}

function changeKatakana() {
    katakana = !katakana;
}

function calculateWordsArray() {
    let words = [];

    if( hiragana ) { words = words.concat(dictionary.hiragana); }
    if( hiragana_tenten ) { words = words.concat(dictionary.hiragana_tenten); }
    if( hiragana_maru ) { words = words.concat(dictionary.hiragana_maru); }
    if( hiragana_diptongo ) { words = words.concat(dictionary.hiragana_diptongo); }
    if( hiragana_diptongo_tenten ) { words = words.concat(dictionary.hiragana_diptongo_tenten); }
    if( hiragana_diptongo_maru ) { words = words.concat(dictionary.hiragana_diptongo_maru); }
    if( katakana ) { words = words.concat(dictionary.katakana); }

    return words;
}









var shuffled = [];
var actualIndex = 0;
var correctCount = 0;
var incorrectCount = 0;
var incorrectIndexes = [];
const rowsPerColumn = 15;

function startTest() {

    document.getElementById("main").innerHTML = `
    <div id="cards" class="cards">
        <div class="element_container">
            <p id="char_element" class="char_element"></p>
            <div id="img_element" class="img_element"></div>
        </div>
        <div class="input_container">
            <tag>Roman syllable:</tag>
            <input id="latin_input" type="text"></input></div>
        <div class="button_container">
            <button id="next_button" onclick="next()">Next</button>
        </div>
    </div>`;

    document.getElementById("latin_input").addEventListener("keypress", function (event) {
        if (event.key === "Enter") {
            event.preventDefault();
            document.getElementById("next_button").click();
        }
    });

    actualIndex = 0;
    correctCount = 0;
    incorrectCount = 0;
    incorrectIndexes = [];

    shuffled = calculateWordsArray().sort((a, b) => 0.5 - Math.random());
    document.getElementById("char_element").innerHTML = shuffled[actualIndex].japanese;
}

function next() {
    let input = document.getElementById("latin_input").value;

    if (input.toUpperCase() == shuffled[actualIndex].latin.toUpperCase()) {
        ++correctCount;
        $('#img_element').css("background-image", "url('images/correct.png')").fadeIn(0).fadeOut();
        document.getElementById("latin_input").value = "";
        document.getElementById("latin_input").placeholder = "";
    } else {
        ++incorrectCount;
        $('#img_element').css("background-image", "url('images/incorrect.png')").fadeIn(0).fadeOut();
        incorrectIndexes.push(actualIndex);
        document.getElementById("latin_input").value = "";
        document.getElementById("latin_input").placeholder = shuffled[actualIndex].latin; // Show correct answer
    }

    if (++actualIndex < shuffled.length) {
        document.getElementById("char_element").innerHTML = shuffled[actualIndex].japanese;
    } else {
        startEnd();
    }
}

function startEnd() {
    document.getElementById("main").innerHTML = `
    <div class="results_container">
        <div><img src="images/correct.png" alt="Correct icon" width="50" height="50"> <p id="correctCounter">0</p></div>
        <div><img src="images/incorrect.png" alt="Incorrect icon" width="50" height="50"> <p id="incorrectCounter">0</p></div>
        <button id="restart" onclick="restart()">Restart</button>
    </div>
    <table id="answers_table" class="answers_table">
        <caption>Incorrect answers</caption>
    </table>`;

    document.getElementById("correctCounter").innerHTML = correctCount;
    document.getElementById("incorrectCounter").innerHTML = incorrectCount;

    if(incorrectCount != 0) {
        let table = "";
        table += "<tbody>";
        for(let i = 0; i < incorrectIndexes.length; i += Math.ceil(incorrectIndexes.length / rowsPerColumn)) {
            table += "<tr>";
            for(let j = i; j < i + Math.ceil(incorrectIndexes.length / rowsPerColumn); ++j) {
                if(j < incorrectIndexes.length)
                    table += "<td>" + shuffled[incorrectIndexes[j]].latin + " : " + shuffled[incorrectIndexes[j]].japanese + "</td>";
            }
            table += "</tr>";
        }
        table += "</tbody>";

        document.getElementById("answers_table").innerHTML += table;
    } else {
        document.getElementById("answers_table").getElementsByTagName("caption")[0].innerHTML = "PERFECT!";
    }
}

function restart() {
    document.getElementById("main").innerHTML = `
    <button class="start_button" onclick="startTest()">Start test</button>
    <div class="checkboxes_container">
        <div>
            <input type="checkbox" id="hiragana" name="hiragana" ` + (hiragana ? `checked` : `false`) + ` onchange="changeHiragana()">
            <label for="hiragana">Hiragana</label><br>
        </div>
        <div>
            <input type="checkbox" id="hiragana_tenten" name="hiragana_tenten" ` + (hiragana_tenten ? `checked` : `false`) + ` onchange="changeHiraganaTenten()">
            <label for="hiragana_tenten">Hiragana Tenten</label><br>
        </div>
        <div>
            <input type="checkbox" id="hiragana_maru" name="hiragana_maru" ` + (hiragana_maru ? `checked` : `false`) + ` onchange="changeHiraganaMaru()">
            <label for="hiragana_maru">Hiragana Maru</label><br>
        </div>
        <div>
            <input type="checkbox" id="hiragana_diptongo" name="hiragana_diptongo" ` + (hiragana_diptongo ? `checked` : `false`) + ` onchange="changeHiraganaDiptongo()">
            <label for="hiragana_diptongo">Hiragana Diptongo</label><br>
        </div>
        <div>
            <input type="checkbox" id="hiragana_diptongo_tenten" name="hiragana_diptongo_tenten" ` + (hiragana_diptongo_tenten ? `checked` : `false`) + ` onchange="changeHiraganaDiptongoTenten()">
            <label for="hiragana_diptongo_tenten">Hiragana Diptongo Tenten</label><br>
        </div>
        <div>
            <input type="checkbox" id="hiragana_diptongo_maru" name="hiragana_diptongo_maru" ` + (hiragana_diptongo_maru ? `checked` : `false`) + ` onchange="changeHiraganaDiptongoMaru()">
            <label for="hiragana_diptongo_maru">Hiragana Diptongo Maru</label><br>
        </div>
        <div>
            <input type="checkbox" id="katakana" name="katakana" ` + (katakana ? `checked` : `false`) + ` onchange="changeKatakana()">
            <label for="katakana">Katakana</label><br>
        </div>
    </div>`;
}